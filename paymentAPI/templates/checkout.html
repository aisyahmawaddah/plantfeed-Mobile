<!DOCTYPE html>
<html>
<head>
  <title>Buy cool new product</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://js.stripe.com/v3/"></script>
</head>

<style>
    /* Style for limiting the size of the product image */
    .product-image {
      max-width: 100%; /* Set maximum width to fill its container */
      max-height: 400px; /* Set maximum height to 400 pixels (adjust as needed) */
      display: block; /* Ensure the image is displayed as a block element */
      margin: auto; /* Center the image horizontally within its container */
    }
</style>

<body>
    <section>
      <div class="product">
        <img src="../media/{{ products.productPhoto }}" alt="The picture of the product" class="product-image"/>
        <div class="description">
          <h3>{{ products.productName }}</h3>
          <h5>RM{{ products.productPrice }}</h5>
        </div>
      </div>
      <form id="checkout-form">
        {% csrf_token %}
        <button type="button" id="checkout-button">Checkout</button>
      </form>
    </section>
  
    <script>
      const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
      var stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}")
      var checkoutButton = document.getElementById('checkout-button');
  
      checkoutButton.addEventListener('click', function() {
        fetch('{% url 'paymentAPI:create-checkout-session' products.productid %}', {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken // Include the CSRF token in the request headers
          }
        })
        .then(function(response) {
          return response.json();
        })
        .then(function(session) {
          // Redirect to the Stripe Checkout session
          stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function(result) {
          // If `redirectToCheckout` fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using `error.message`.
          if (result.error) {
            alert(result.error.message);
          }
        })    
        .catch(function(error) {
          console.error('Error:', error);
        });
      });
    </script>
  </body>
</html>
